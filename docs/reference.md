# API 参考文档

## 工具命令

### 基本用法

```bash
# 提取单个 PDF
npm run pdf <pdf路径>

# 批量提取
npm run pdf "papers/*.pdf" --batch

# 指定输出目录
npm run pdf <pdf路径> -o <输出目录>

# 只输出 JSON（不保存文件）
npm run pdf <pdf路径> --json
```

### 命令参数

| 参数 | 简写 | 说明 | 默认值 |
|------|------|------|--------|
| `--output` | `-o` | 指定输出目录 | `extracted` |
| `--batch` | `-b` | 批量处理模式，支持通配符 | - |
| `--json` | - | 只输出 JSON 到控制台，不保存文件 | - |

### 输出文件结构

```
extracted/<pdf名称>/
├── content.txt      # 纯文本内容（你应该读取这个来分析）
├── extracted.json   # 完整提取结果
└── info.md          # 元数据摘要
```

#### content.txt
- 纯文本格式
- UTF-8 编码
- 包含 PDF 所有文本内容
- 最适合 Claude 直接读取分析

#### extracted.json
```json
{
  "pdfPath": "/path/to/paper.pdf",
  "metadata": {
    "title": "Paper Title",
    "author": "Author Name",
    "pages": 10,
    "creationDate": "2023-01-01T00:00:00.000Z"
  },
  "text": "完整文本内容...",
  "hash": "abc123456789",
  "extractedAt": "2023-12-19T10:00:00.000Z"
}
```

#### info.md
Markdown 格式的元数据摘要，包含：
- 文件名
- 页数
- 字符数
- Hash 值（用于缓存）
- 提取时间
- 标题、作者（如果有）

## 技术细节

### 缓存机制

工具使用基于内容 MD5 的缓存系统：

1. **Hash 计算**：提取 PDF 文本后，计算内容的 MD5 hash（前 12 位）
2. **缓存位置**：`.cache/<hash>/extracted.json`
3. **缓存命中**：同一 PDF 再次提取时，直接返回缓存结果
4. **缓存失效**：PDF 内容改变时，hash 变化，自动重新提取

### 批量处理

批量模式的特性：
- **并行度**：最多同时处理 3 个 PDF
- **错误处理**：单个文件失败不影响其他文件
- **进度显示**：显示 `[当前/总数]` 进度
- **结果汇总**：完成后显示成功/失败统计

### 性能数据

| PDF 大小 | 页数 | 提取时间 | 缓存命中时间 |
|---------|------|----------|-------------|
| 小文件 | < 10 页 | 0.5-1 秒 | < 0.1 秒 |
| 中等文件 | 10-50 页 | 1-3 秒 | < 0.1 秒 |
| 大文件 | > 50 页 | 3-10 秒 | < 0.1 秒 |

## 环境配置

### 系统要求

- Node.js >= 18
- npm 或 yarn
- 支持的操作系统：macOS、Linux、Windows

### 依赖项

- **pdf-parse**: PDF 文本解析库
- **glob**: 文件匹配和批量处理
- **tsx**: TypeScript 直接执行

### 安装

```bash
# 克隆或复制 skill 到本地
cd pdf_Skills

# 安装依赖
npm install

# 测试运行
npm run pdf test.pdf
```

## 限制和注意事项

### PDF 格式支持

- ✅ 支持标准文本 PDF
- ✅ 支持嵌入字体的 PDF
- ⚠️ 扫描版 PDF（纯图片）提取效果受限
- ⚠️ 加密/受保护的 PDF 可能无法提取

### 大文件处理

对于超大 PDF（> 100 页 / > 50MB）：
1. 提取时间较长（10+ 秒）
2. 文本内容可能很大（> 100KB）
3. 建议分段分析，避免占用过多上下文

### 文本质量

提取的文本质量取决于：
- PDF 的原始质量
- 文本编码方式
- 字体嵌入情况
- 页面布局复杂度

对于复杂排版（多栏、表格、公式），文本顺序可能不完全准确。
